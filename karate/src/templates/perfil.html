{% extends 'base.html' %}

{% block title %}
Perfil del estudiante
{% endblock %}

{% block scripts %}
<!-- Bootstrap datepicker CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css"/>
<!-- Bootstrap datepicker JS-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
{% endblock %}

{% block body %}

{% if alumno != None %}

{% if form %}
<!-- Modal para editar alumno -->
<div class="modal fade" id="editar-modal" tabindex="-1" role="dialog" aria-labelledby="editarModalLabel" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editarModalLabel">Editar Alumno</h5>
                <button type="button" class="btn-close" aria-label="Close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form action="/editar_alumno" method="post" class="needs-validation" id="form-editar" novalidate>
                    {{ form.hidden_tag() }}
                    <input type="hidden" name="next" value="{{ url_for('profile', id = alumno.id ) }}" />
                    <!--Estatus-->
					<div data-mdb-input-init class="form-outline mb-2 shadow-sm hide-this">
						<div class="input-group">
							<span class="input-group-text">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
									class="bi bi-bookmark-star-fill" viewBox="0 0 16 16">
									<path fill-rule="evenodd" d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5M8.16 4.1a.178.178 0 0 0-.32 0l-.634 1.285a.18.18 0 0 1-.134.098l-1.42.206a.178.178 0 0 0-.098.303L6.58 6.993c.042.041.061.1.051.158L6.39 8.565a.178.178 0 0 0 .258.187l1.27-.668a.18.18 0 0 1 .165 0l1.27.668a.178.178 0 0 0 .257-.187L9.368 7.15a.18.18 0 0 1 .05-.158l1.028-1.001a.178.178 0 0 0-.098-.303l-1.42-.206a.18.18 0 0 1-.134-.098z" />
								</svg>
							</span>
							<div class="form-floating">
								<div class="form-floating">
									{{ form.estatus(class="form-control shadow", id="edit-estatus") }}
									{{ form.estatus.label(for="edit-estatus") }}
									<span class="invalid-feedback my-1 px-2 fw-bold">
										<div class="d-flex flex-column justify-content-evenly">
											<small>● El apellido sólo debe contener letras y/o guiones (-).</small>
											<small>● Si el apellido es compuesto, debe ir separado por un guión (-).</small>
											{% for error in form.estatus.errors %}
											<small>● {{error}}</small>
											{% endfor %}
										</div>
									</span>
								</div>
							</div>
						</div>
					</div>
                    <!--Nombres-->
					<div data-mdb-input-init class="form-outline mb-2 shadow-sm">
						<div class="form-floating">
							{{ form.nombres(class="form-control shadow", pattern="^([a-zA-ZÀ-ú]{2,})([ ]?[a-zA-ZÀ-ú]{2,})*$", placeholder="Nombre(s)", required = True, id="edit-nombres") }}
							{{ form.nombres.label }}
							<span class="invalid-feedback my-1 px-2 fw-bold">
								<div class="d-flex flex-column justify-content-evenly">
									<small>● Los nombres sólo pueden contener letras.</small>
									<small>● Los nombres deben ir separados por un único caracter de espacio.</small>
									{% for error in form.nombres.errors %}
									<small>● {{error}}</small>
									{% endfor %}
								</div>
							</span>
						</div>
					</div>
                    <!--Apellidos-->
					<div data-mdb-input-init class="form-outline mb-2 shadow-sm">
						<div class="input-group">
							<div class="form-floating">
								{{ form.apellido_paterno(class="form-control shadow", pattern="^([a-zA-ZÀ-ú]{2,})([ \-]?[a-zA-ZÀ-ú]{2,})*$", placeholder="Nombre(s)", required = True, id="edit-apellido-paterno") }}
								{{ form.apellido_paterno.label }}
								<span class="invalid-feedback my-1 px-2 fw-bold">
									<div class="d-flex flex-column justify-content-evenly">
										<small>● El apellido sólo debe contener letras.</small>
										<small>● Los apellidos compuestos deben ir separados por un guión (-).</small>
										{% for error in form.apellido_paterno.errors %}
										<small>● {{error}}</small>
										{% endfor %}
									</div>
								</span>
							</div>
							<div class="form-floating">
								{{ form.apellido_materno(class="form-control shadow", pattern="^([a-zA-ZÀ-ú]{2,})([ \-]?[a-zA-ZÀ-ú]{2,})*$", placeholder="Nombre(s)", required = True, id="edit-apellido-materno") }}
								{{ form.apellido_materno.label }}
								<span class="invalid-feedback my-1 px-2 fw-bold">
									<div class="d-flex flex-column justify-content-evenly">
										<small>● El apellido sólo debe contener letras.</small>
										<small>● Los apellidos compuestos deben ir separados por un guión (-).</small>
										{% for error in form.apellido_materno.errors %}
										<small>● {{error}}</small>
										{% endfor %}
									</div>
								</span>
							</div>
						</div>
					</div>
					<!--Fecha de nacimiento-->
					<div data-mdb-input-init class="form-outline mb-2 shadow-sm">
						<div class="input-group">
							<span class="input-group-text">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
									class="bi bi-key" viewBox="0 0 16 16">
									<path d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z"/>
									<path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
								</svg>
							</span>
							<div class="form-floating">
								{{ form.fecha_nacimiento(class="form-control shadow", min=form.date_min, max=form.date_max, onkeydown="onkeydowndate(event)", id="edit-fecha-nacimiento") }}
								{{ form.fecha_nacimiento.label }}
								<span class="invalid-feedback my-1 px-2 fw-bold">
									<div class="d-flex flex-column justify-content-evenly">
										<small>● Elige una fecha válida.</small>
										{% for error in form.fecha_nacimiento.errors %}
										<small>● {{error}}</small>
										{% endfor %}
									</div>
								</span>
							</div>
                            <span class="input-group-text">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-key mt-3" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5"/>
								</svg>
							</span>
						</div>
					</div>
                    <!--telefono-->
					<div data-mdb-input-init class="form-outline mb-2 shadow-sm bg-white">
                        <p class="lh-sm mb-2 mx-3 fw-bold">Datos de contacto</p>
						<div class="input-group">
							<span class="input-group-text">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-key" viewBox="0 0 16 16">
									<path fill-rule="evenodd" d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.68.68 0 0 0 .178.643l2.457 2.457a.68.68 0 0 0 .644.178l2.189-.547a1.75 1.75 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.6 18.6 0 0 1-7.01-4.42 18.6 18.6 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877z" />
								</svg>
							</span>
							<div class="form-floating">
								{{ form.telefono(class="form-control shadow", pattern="^[0-9]{10}$", placeholder="telefono", required = True, id="edit-telefono") }}
								{{ form.telefono.label }}
								<span class="invalid-feedback my-1 px-2 fw-bold">
									<div class="d-flex flex-column justify-content-evenly">
										<small>● Ingresa un teléfono válido (10 dígitos, sin guiones).</small>
										<small>● No debe contener letras, espacios o caracteres especiales.</small>
										{% for error in form.cinturon.errors %}
										<small>● {{error}}</small>
										{% endfor %}
									</div>
								</span>
							</div>
						</div>
					</div>
					<!--Cinta-->
					<div data-mdb-input-init class="form-outline mb-2 shadow-sm hide-this">
                        <p class="lh-sm mb-2 mx-3 fw-bold">Nivel de ingreso</p>
						<div class="input-group">
							<span class="input-group-text">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
									class="bi bi-bookmark-star-fill" viewBox="0 0 16 16">
									<path fill-rule="evenodd" d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5M8.16 4.1a.178.178 0 0 0-.32 0l-.634 1.285a.18.18 0 0 1-.134.098l-1.42.206a.178.178 0 0 0-.098.303L6.58 6.993c.042.041.061.1.051.158L6.39 8.565a.178.178 0 0 0 .258.187l1.27-.668a.18.18 0 0 1 .165 0l1.27.668a.178.178 0 0 0 .257-.187L9.368 7.15a.18.18 0 0 1 .05-.158l1.028-1.001a.178.178 0 0 0-.098-.303l-1.42-.206a.18.18 0 0 1-.134-.098z" />
								</svg>
							</span>
							<div class="form-floating">
								<div class="form-floating">
									{{ form.cinturon(class="form-control shadow", id="edit-cinturon") }}
									{{ form.cinturon.label }}
									<span class="invalid-feedback my-1 px-2 fw-bold">
										<div class="d-flex flex-column justify-content-evenly">
											<small>● El apellido sólo debe contener letras y/o guiones (-).</small>
											<small>● Si el apellido es compuesto, debe ir separado por un guión (-).</small>
											{% for error in form.cinturon.errors %}
											<small>● {{error}}</small>
											{% endfor %}
										</div>
									</span>
								</div>
							</div>
						</div>
					</div>
                    <!-- Botones para enviar y cerrar -->
                    <div class="mt-4 d-grid d-flex gap-2">
                        {{ form.submit(class="btn btn-success btn-lg w-100", id="submit-editar", value="Actualizar datos") }}
                        <button type="button" id="submitBtn" class="btn btn-primary btn-lg w-100" aria-label="Close" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- modal para cambiar sólo la cinta -->
<div class="modal fade" id="editar-cinta-modal" tabindex="-1" role="dialog" aria-labelledby="editarModalLabel" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editarModalLabel">Cambiar el rango del estudiante</h5>
                <button type="button" class="btn-close end-0" aria-label="Close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form action="/perfil/alumno/cambiar_cinta" method="post" class="needs-validation" id="form-editar" novalidate>
        
                    <input type="hidden" name="alumno_id" id="cinta-alumno-id">
					<!--Cinta-->
					<div data-mdb-input-init class="form-outline mb-2 shadow-sm">
                        <p class="lh-sm mb-2 mx-3 fw-bold">Selecciona el nuevo color de cinta</p>
						<div class="input-group">
							<span class="input-group-text">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
									class="bi bi-bookmark-star-fill" viewBox="0 0 16 16">
									<path fill-rule="evenodd" d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5M8.16 4.1a.178.178 0 0 0-.32 0l-.634 1.285a.18.18 0 0 1-.134.098l-1.42.206a.178.178 0 0 0-.098.303L6.58 6.993c.042.041.061.1.051.158L6.39 8.565a.178.178 0 0 0 .258.187l1.27-.668a.18.18 0 0 1 .165 0l1.27.668a.178.178 0 0 0 .257-.187L9.368 7.15a.18.18 0 0 1 .05-.158l1.028-1.001a.178.178 0 0 0-.098-.303l-1.42-.206a.18.18 0 0 1-.134-.098z" />
								</svg>
							</span>
							<div class="form-floating">
								<div class="form-floating">
									{{ form.cinturon(class="form-control shadow", id="cinta-nuevo-valor") }}
									{{ form.cinturon.label }}
									<span class="invalid-feedback my-1 px-2 fw-bold">
										<div class="d-flex flex-column justify-content-evenly">
											<small>● El apellido sólo debe contener letras y/o guiones (-).</small>
											<small>● Si el apellido es compuesto, debe ir separado por un guión (-).</small>
											{% for error in form.cinturon.errors %}
											<small>● {{error}}</small>
											{% endfor %}
										</div>
									</span>
								</div>
							</div>
						</div>
					</div>
                    <!-- Botones para enviar y cerrar -->
                    <div class="mt-4 d-grid d-flex gap-2">
                        {{ form.submit(class="btn btn-success btn-lg w-100", id="submit-editar", value="Actualizar datos") }}
                        <button type="button" id="submitBtn" class="btn btn-primary btn-lg w-100" aria-label="Close" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Modal para añadir pagos -->
{% if pagoForm %}
<div class="modal fade" id="modal-agregar-pago" tabindex="-1" role="dialog" aria-labelledby="editarModalLabel" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal-agregar-pago-title"style="color: black;">Agregar nueva información de pago</h5>
                <button type="button" class="btn-close end-0" aria-label="Close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form action="#" method="post" class="needs-validation" id="form-pago" novalidate>
                    {{ form.hidden_tag() }}
                    <input type="hidden" name="next" value="{{ url_for('profile', id = alumno.id ) }}" />
                    <!--Abono-->
					<div data-mdb-input-init class="form-outline mb-2 shadow-sm">
						<div class="input-group">
							<span class="input-group-text">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
									class="bi bi-bookmark-star-fill" viewBox="0 0 16 16">
									<path fill-rule="evenodd" d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5M8.16 4.1a.178.178 0 0 0-.32 0l-.634 1.285a.18.18 0 0 1-.134.098l-1.42.206a.178.178 0 0 0-.098.303L6.58 6.993c.042.041.061.1.051.158L6.39 8.565a.178.178 0 0 0 .258.187l1.27-.668a.18.18 0 0 1 .165 0l1.27.668a.178.178 0 0 0 .257-.187L9.368 7.15a.18.18 0 0 1 .05-.158l1.028-1.001a.178.178 0 0 0-.098-.303l-1.42-.206a.18.18 0 0 1-.134-.098z" />
								</svg>
							</span>
							<div class="form-floating">
								<div class="form-floating">
									{{ pagoForm.abono(class="form-control shadow", min="0", max="3600", step=".01", length="7", pattern="^[0-9]{1,4}([.][0-9]{2,2})?$") }}
									{{ pagoForm.abono.label }}
									<span class="invalid-feedback my-1 px-2 fw-bold">
										<div class="d-flex flex-column justify-content-evenly">
											<small>● El monto de abono no puede ser negativo.</small>
											<small>● La cantidad máxima de abono es de $3600.00.</small>
										</div>
									</span>
								</div>
							</div>
						</div>
					</div>
                    <!--Meses abono-->
					<div data-mdb-input-init class="form-outline mb-2 shadow-sm">
                        {{ pagoForm.meses_abono.label }}
						<div class="input-group">
							<span class="input-group-text">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
									class="bi bi-bookmark-star-fill" viewBox="0 0 16 16">
									<path fill-rule="evenodd" d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5M8.16 4.1a.178.178 0 0 0-.32 0l-.634 1.285a.18.18 0 0 1-.134.098l-1.42.206a.178.178 0 0 0-.098.303L6.58 6.993c.042.041.061.1.051.158L6.39 8.565a.178.178 0 0 0 .258.187l1.27-.668a.18.18 0 0 1 .165 0l1.27.668a.178.178 0 0 0 .257-.187L9.368 7.15a.18.18 0 0 1 .05-.158l1.028-1.001a.178.178 0 0 0-.098-.303l-1.42-.206a.18.18 0 0 1-.134-.098z" />
								</svg>
							</span>
                            {{ pagoForm.meses_abono(class="form-select shadow", min="0", max="3600", step=".01", length="7", pattern="^[0-9]{1,4}([.][0-9]{2,2})?$") }}
                            <span class="invalid-feedback my-1 px-2 fw-bold">
                                <div class="d-flex flex-column justify-content-evenly">
                                    <small>● El monto de abono no puede ser negativo.</small>
                                    <small>● La cantidad máxima de abono es de $3600.00.</small>
                                </div>
                            </span>
						</div>
					</div>
                    <!--Meses adeudo-->
					<div data-mdb-input-init class="form-outline mb-2 shadow-sm">
                        {{ pagoForm.meses_adeudo.label }}
						<div class="input-group">
							<span class="input-group-text">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
									class="bi bi-bookmark-star-fill" viewBox="0 0 16 16">
									<path fill-rule="evenodd" d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5M8.16 4.1a.178.178 0 0 0-.32 0l-.634 1.285a.18.18 0 0 1-.134.098l-1.42.206a.178.178 0 0 0-.098.303L6.58 6.993c.042.041.061.1.051.158L6.39 8.565a.178.178 0 0 0 .258.187l1.27-.668a.18.18 0 0 1 .165 0l1.27.668a.178.178 0 0 0 .257-.187L9.368 7.15a.18.18 0 0 1 .05-.158l1.028-1.001a.178.178 0 0 0-.098-.303l-1.42-.206a.18.18 0 0 1-.134-.098z" />
								</svg>
							</span>
                            {{ pagoForm.meses_adeudo(class="form-select shadow", min="0", max="3600", step=".01", length="7", pattern="^[0-9]{1,4}([.][0-9]{2,2})?$") }}
                            <span class="invalid-feedback my-1 px-2 fw-bold">
                                <div class="d-flex flex-column justify-content-evenly">
                                    <small>● El monto de abono no puede ser negativo.</small>
                                    <small>● La cantidad máxima de abono es de $3600.00.</small>
                                </div>
                            </span>
						</div>
					</div>
                    <!--Adeudo-->
					<div data-mdb-input-init class="form-outline mb-2 shadow-sm">
						<div class="input-group">
							<span class="input-group-text">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
									class="bi bi-bookmark-star-fill" viewBox="0 0 16 16">
									<path fill-rule="evenodd" d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5M8.16 4.1a.178.178 0 0 0-.32 0l-.634 1.285a.18.18 0 0 1-.134.098l-1.42.206a.178.178 0 0 0-.098.303L6.58 6.993c.042.041.061.1.051.158L6.39 8.565a.178.178 0 0 0 .258.187l1.27-.668a.18.18 0 0 1 .165 0l1.27.668a.178.178 0 0 0 .257-.187L9.368 7.15a.18.18 0 0 1 .05-.158l1.028-1.001a.178.178 0 0 0-.098-.303l-1.42-.206a.18.18 0 0 1-.134-.098z" />
								</svg>
							</span>
                            <div class="form-floating">
                                {{ pagoForm.adeudo(class="form-control shadow", min="0", max="3600", step=".01", length="7", pattern="^[0-9]{1,4}([.][0-9]{2,2})?$") }}
                                {{ pagoForm.adeudo.label }}
                                <span class="invalid-feedback my-1 px-2 fw-bold">
                                    <div class="d-flex flex-column justify-content-evenly">
                                        <small>● El monto de abono no puede ser negativo.</small>
                                        <small>● La cantidad máxima de abono es de $3600.00.</small>
                                    </div>
                                </span>
                            </div>
						</div>
					</div>
                    
                    <!-- Botones para enviar y cerrar -->
                    <div class="mt-4 d-grid d-flex gap-2">
                        {{ pagoForm.submit(class="btn btn-success btn-lg w-100") }}
                        <button type="button" id="submitBtn" class="btn btn-primary btn-lg w-100" aria-label="Close" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- modal para agregar una asistencia -->
<div class="modal fade" id="agregar-asistencia-modal" tabindex="-1" role="dialog" aria-labelledby="editarModalLabel" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editarModalLabel">Agregar nueva asistencia</h5>
                <button type="button" class="btn-close end-0" aria-label="Close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Formulario para agregar asistencia -->
                {% if asistenciaForm %}
                <form action="{{url_for('registrar_asistencia')}}" method="post" novalidate class="needs-validation" id="formulario">
                    <h5 class="text-center">Registrar una nueva asistencia</h5>
                    <!-- Hidden input to store the next argument -->
                    <input type="hidden" name="next" id="next" value="{{ request.args.get('next', '') }}" />
                    {{ asistenciaForm.csrf_token }}
                    {{ asistenciaForm.id_alumno(value=alumno.id) }}
                    <!--DIA-SEMANA Y HORA -->
                    <div data-mdb-input-init class="form-outline mb-3 shadow">
                        <div class="input-group">
                            <span class="input-group-text">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-key" viewBox="0 0 16 16">
                                    <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71z"/>
                                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0"/>                              
                                </svg>
                            </span>
                            <div class="form-floating">
                                {{ asistenciaForm.dia_clase(class="form-select", id="select-dia") }}
                                {{ asistenciaForm.dia_clase.label }}
                            </div>
                            <div class="form-floating">
                                {{ asistenciaForm.hora_clase(class="form-select", id="select-hora") }}
                                {{ asistenciaForm.hora_clase.label }}
                            </div>
                        </div>
                    </div>
                    <!--DATE-->
                    <div data-mdb-input-init class="form-outline mb-5 shadow">
                        <div class="input-group">
                            <span class="input-group-text">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                                    class="bi bi-key" viewBox="0 0 16 16">
                                    <path d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z"/>
                                    <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
                                </svg>
                            </span>
                            <div class="form-floating">
                                {{ asistenciaForm.fecha_asistencia(class="form-control form-control-lg", id="select-fecha", max="2024-05-17", min="2000-01-01", data_provider="datepicker", readonly="true") }}
                                {{ asistenciaForm.fecha_asistencia.label  }}
                                <span class="invalid-feedback my-1 px-2 fw-bold">
                                    <div class="d-flex flex-column justify-content-evenly">
                                        <small>● Ingrese una fecha válida.</small>
                                        <small>● La fecha no puede ser posterior al día actual.</small>
                                        <small>● Asegúrese de que la fecha coincida con el día elegido.</small>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                    <!--SUBMIT-->
                    <div class="d-grid d-flex gap-2 mb-2 shadow-lg mt-auto">
                        {{ asistenciaForm.submit(class="btn btn-danger btn-lg w-100") }}
                        <button type="button" id="submitBtn" class="btn btn-primary btn-lg w-100" aria-label="Close" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </form>
                {% endif %}
                <!-- ---------------------------------- -->
            </div>
        </div>
    </div>
</div>

<!-- modal para eliminar una asistencia -->
<div class="modal fade" id="eliminar-asistencia-modal" tabindex="-1" role="dialog" aria-labelledby="eliminarAsistenciaModalLabel" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editarModalLabel">Confirmar acción</h5>
                <button type="button" class="btn-close end-0" aria-label="Close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="fs-5">Se eliminará la asistencia de forma irreversible, ¿estás seguro de realizar esta acción?</p>
                <!-- Formulario para confirmar que se eliminará una asistencia -->
                <form action="{{url_for('eliminar_asistencia')}}" method="post" novalidate>
                    <input type="text" hidden value="_" id="id_alumno_eliminar" name="id_alumno_eliminar">         
                    <input type="date" hidden value="2000-01-01" id="fecha_eliminar" name="fecha_eliminar">
                    <input type="text" hidden value="_" id="dia_eliminar" name="dia_eliminar">
                    <input type="text" hidden value="_" id="hora_eliminar" name="hora_eliminar">

                    <div class="d-grid d-flex gap-2 column-gap-4 mb-2-lg mt-auto">
                        <button type="submit" class="btn btn-danger shadow scale-anim w-100 fw-bold p-2">Eliminar asistencia</button>
                        <button type="button" class="btn btn-primary shadow scale-anim w-100 fw-bold p-2" aria-label="Close" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </form>
                <!-- ---------------------------------- -->
            </div>
        </div>
    </div>
</div>

<!-- Modal para eliminar un pago -->
<div class="modal fade modal-sm" id="modal-eliminar-pago" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editarModalLabel">Confirmar acción</h5>
                <button type="button" class="btn-close end-0" aria-label="Close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Se eliminará el pago seleccionado, ¿estás seguro de realizar esta acción?</p>
            </div>
            <div class="modal-footer">
                <!-- Formulario para confirmar que se eliminará una asistencia -->
                <form action="{{url_for('eliminar_pago')}}" method="post" novalidate>
                    <input type="text" hidden value="_" id="id_pago_alumno-pago" name="id_pago_alumno">         
                    <input type="text" hidden value="_" id="id_alumno-pago" name="id_alumno">
                    
                    <button type="submit" class="btn btn-danger shadow scale-anim  fw-semibold p-2">Eliminar pago</button>
                    <button type="button" class="btn btn-primary shadow scale-anim fw-semibold p-2" aria-label="Close" data-bs-dismiss="modal">Cerrar</button>
                </form>
                <!-- ---------------------------------- -->
            </div>
        </div>
    </div>
</div>

<!-- contenido principal -->
<div class="container-fluid bg-black">
    <!-- Tabla de información -->
    <div class="row d-flex justify-content-center">
        <div class="col-6 g-0">
            <div class="card bg-black px-4 py-3">
                <div class="card-body">

                    <!--IMAGEN Y NOMBRE-->
                    <div class="mb-4 text-center rounded-5 shadow-lg">
                        <div class="d-flex justify-content-center p-2">
                            <img src="{{url_for('static', filename='img/karate.png')}}" class="img-circle bg-white border border-5 scale-anim" alt="Ícono del usuario" width="150" height="150">
                        </div>
                        <h3 class="card-title text-white text-center lh-1">{{alumno.nombres}} {{alumno.apellido_paterno}} {{alumno.apellido_materno}}</h3>
                    </div>
                    <!-- mensajes de éxito -->
                    {% with successes = get_flashed_messages(category_filter=["success"]) %}
                    {% if successes %}
                            {% for success in successes %}
                            <div class="alert alert-success alert-dismissible fade show mb-4 m-3" role="alert">
                                <span class="text-success fw-bold">{{ success }}</span>
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}
                    <!-- Mensajes de error -->
                    {% with errors = get_flashed_messages(category_filter=["error"]) %}
                    {% if errors %}
                            {% for error in errors %}
                            <div class="alert alert-danger alert-dismissible fade show mb-4 m-3" role="alert">
                                <span class="text-danger fw-bold">{{ error }}</span>
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <!--CINTA-Y-DATOS-->
                    <div class="row row-cols-2 flex-row mb-2">
                        <!--CINTURÓN ACTUAL-->
                        <div class="col-5">
                            <div class="card  p-3 rounded-5 shadow-lg h-100 d-flex justify-content-evenly">
                                {% if alumno.cinta[0] == 1 %}
                                <span class="bg-white rounded-pill fs-5 border border-3 scale-anim shadow-sm">Cinturón</span>
                                {% elif alumno.cinta[0] == 2 %}
                                <span class="badge bg-warning rounded-pill fs-5 border-warning-subtle border-3 scale-anim shadow-sm">Cinturón</span>
                                {% elif alumno.cinta[0] == 3 %}
                                <span class="badge rounded-pill fs-5 border-3 scale-anim shadow-sm" style="background-color: rgb(255, 110, 0); border-color: rgb(255, 180, 0);">Cinturón</span>
                                {% elif alumno.cinta[0] == 4 %}
                                <span class="badge rounded-pill fs-5 border-3 scale-anim shadow-sm" style="background-color: rgb(150, 0, 180); border-color: rgb(179, 0, 215);">Cinturón</span>
                                {% elif alumno.cinta[0] == 5 %}
                                <span class="badge bg-primary rounded-pill fs-5 border-primary-subtle border-3 scale-anim shadow-sm">Cinturón</span>
                                {% elif alumno.cinta[0] == 6 %}
                                <span class="badge bg-success rounded-pill fs-5 border-success-subtle border-3 scale-anim shadow-sm">Cinturón</span>
                                {% elif alumno.cinta[0] == 7 %} {# Café #}
                                <span class="badge rounded-pill fs-5 border-3 scale-anim shadow-sm" style="background-color: rgb(70, 50, 40); border-color: rgb(80, 60, 50);">Cinturón</span>
                                {% elif alumno.cinta[0] == 8 %}
                                <span class="w-100 badge bg-danger rounded-pill fs-5 border-danger-subtle border-3 scale-anim shadow-sm">Cinturón</span>
                                {% elif alumno.cinta[0] == 9 %}
                                <span class="badge bg-dark rounded-pill fs-5 border-light-subtle border-3 scale-anim shadow-sm">Cinturón</span>
                                {% endif %}
                                
                                {% set imgCinta = 'Cinta'~alumno.cinta[0] %}
                                <div class="d-flex justify-content-center p-3  mt-3 ">
                                    <img src="{{url_for('static', filename='img/cintas/' ~ imgCinta ~ '.png')}}" alt="Cinta del alumno" class="img-circle bg-white border border-5 scale-anim shadow-sm" width="200">
                                </div>
                                <!--BOTON-EDITAR-->
                                <div class="mb-1 mt-auto mx-auto">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <button class="btn btn-primary rounded-3" data-bs-toggle="modal" data-bs-target="#editar-cinta-modal"
                                            data-id="{{ alumno.id }}"
                                            data-cinta="{{ alumno.cinta[0] }}">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-up" viewBox="0 0 16 16">
                                                    <path fill-rule="evenodd" d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5"/>
                                                </svg>
                                                <strong>Cambiar</strong>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--DATOS PERSONALES-->
                        <div class="col-7">
                            <div class="card list-group p-2 rounded-5 shadow-lg h-100">
                                <div class="my-2">
                                    <h4 class="text-center">Datos del alumno</h4>
                                </div>
                                <!--ESTATUS-->
                                {% if alumno.estatus == 'ACTIVO' %}
                                    {% set classes='bg-success border-success-subtle' %}
                                    {% set mensaje='El alumno se encuentra al día con sus pagos.' %}
                                    {% set classesMensaje='text-success' %}
                                {% elif alumno.estatus == 'PENDIENTE' %}
                                    {% set classes='bg-warning border-warning-subtle' %}
                                    {% set mensaje='No podrá asistir a más clases hasta realizar los pagos pendientes.' %}
                                    {% set classesMensaje='text-warning' %}
                                {% else %}
                                    {% set classes='bg-danger border-danger-subtle' %}
                                    {% set mensaje='Ya no es alumno del dojo.' %}
                                    {% set classesMensaje='text-danger' %}
                                {% endif %}
                                <div class="list-group-item mb-1">
                                    <div class="container-fluid">
                                        <div class="row row-cols-2">
                                            <div class="col text-wrap p-0">
                                                <p class="my-0 fs-6 fw-semibold">Estatus</p>
                                            </div>
                                            <div class="col">
                                                <span class="badge rounded-pill border border-3 scale-anim w-100 h-100 {{classes}}">{{ alumno.estatus }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item mb-1">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col text-center p-0 {{classesMensaje}}">
                                                {{mensaje}}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--FECHA DE NACIMIENTO-->
                                <div class="list-group-item mb-1">
                                    <div class="container-fluid">
                                        <div class="row row-cols-2">
                                            <div class="col text-wrap p-0">
                                                <p class="my-0 fs-6 fw-semibold">Fecha de nacimiento</p>
                                            </div>
                                            <div class="col">
                                                <p class="my-0">{{ '%02d'|format(alumno.fecha_nacimiento.day|int) }}-{{ alumno.mes_nacimiento|lower }}-{{ alumno.fecha_nacimiento.year }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--EDAD-->
                                <div class="list-group-item mb-1">
                                    <div class="container-fluid ">
                                        <div class="row row-cols-2">
                                            <div class="col text-wrap p-0">
                                                <p class="my-0 fs-6 fw-semibold">Edad</p>
                                            </div>
                                            <div class="col">
                                                <p class="my-0">{{ alumno.edad }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--TELEFONO-->
                                <div class="list-group-item mb-1">
                                    <div class="container-fluid ">
                                        <div class="row row-cols-2">
                                            <div class="col text-wrap p-0">
                                                <p class="my-0 fs-6 fw-semibold">Teléfono</p>
                                            </div>
                                            <div class="col">
                                                <p class="my-0">{{ alumno.telefono }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--ATISTENCIAS-->
                                <div class="list-group-item mb-1">
                                    <div class="container-fluid ">
                                        <div class="row row-cols-2">
                                            <div class="col text-wrap p-0">
                                                <p class="my-0 fs-6 fw-semibold">Total de asistencias</p>
                                            </div>
                                            <div class="col">
                                                <p class="my-0">{{ alumno.total_asistencias }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--BOTON-EDITAR-->
                                <div class="d-grid gap-0 px-4 mb-1 mt-2">
                                    <button class="btn btn-primary rounded-3" data-bs-toggle="modal" data-bs-target="#editar-modal"
                                    data-id="{{ alumno.id }}"
                                    data-estatus="{{ alumno.estatus }}"
                                    data-nombres="{{ alumno.nombres }}"
                                    data-app="{{ alumno.apellido_paterno }}"
                                    data-apm="{{ alumno.apellido_materno }}"
                                    data-fecha="{{ alumno.fecha_nacimiento }}"
                                    data-cinturon="{{ alumno.cinta[0] }}"
                                    data-telefono="{{ alumno.telefono }}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-lines-fill" viewBox="0 0 16 16">
                                            <path d="M6 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-5 6s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zM11 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5m.5 2.5a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1zm2 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1zm0 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1z"/>
                                        </svg>
                                        <strong>Editar datos</strong>
                                    </button>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!--Tabla de asistencias-->
    <div class="row d-flex justify-content-center">
        <div class="col-6 mt-3">
            <div class="card rounded-5 mb-3">
                <div class="card-header">
                    <div class="d-flex align-items-center">
                        <h3 class="card-title mx-3 text-center w-100">Asistencias a clases</h3>
                    </div>                    
                </div>

                <div class="mt-4 d-grid d-flex gap-2 justify-content-center">
                    <button type="button" id="agregar-asistencia-button" class="btn btn-primary w-25 rounded-3" 
                        data-bs-toggle="modal" 
                        data-bs-target="#agregar-asistencia-modal"
                        >
                        <strong>Agregar asistencia</strong>
                    </button>
                </div>
                
                <div class="card-body">

                    <!-- Tabla de datos  -->
                    <div class="row justify-content-center pt-3">
                        <div class=" col-10">
                            <h5 class="text-center fw-bold">Asistencias a clases de {{alumno.nombres}} {{alumno.apellido_paterno}} {{alumno.apellido_materno}}</h5>
                            
                            <div class="d-flex justify-content-center">
                                <table class="table table-sm table-bordered table-hover table-striped rounded-4 overflow-hidden text-center shadow">
                                    <thead class="table-dark">
                                        <tr>
                                            <th scope="col"></th>
                                            <th scope="col">Item</th>
                                            <th scope="col">Fecha completa</th>
                                            <th scope="col"></th>
                                            <th scope="col">Día</th>
                                            <th scope="col">Horario</th>
                                            <td scope="col"></td>
                                            <th scope="col"></th>
                                            <th scope="col"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% if lista_asistencia | length > 0 %}
                                        {% for asistencia in lista_asistencia %}
                                        <tr style="cursor: pointer;">
                                            
                                            {% set fecha = asistencia[4] %}
                                            <td></td>
                                            <td>{{ loop.index }}</td>
                                            <td>{{ asistencia[4] }}</td>
                                            <td></td>
                                            <td>{{ asistencia[0] }}</td>
                                            <td>{{ asistencia[1] }} hrs</td>
                                            <td></td>
                                            <td class="">
                                                <button type="button" class="btn btn-danger btn-sm shadow scale-anim p-0 fw-semibold"
                                                    data-bs-toggle="modal" data-bs-target="#eliminar-asistencia-modal"
                                                    data-alumno-id="{{ alumno.id }}"
                                                    data-fecha="{{ fecha }}"
                                                    data-dia-sem="{{ asistencia[2] }}"
                                                    data-hora="{{ asistencia[3] }}">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                                                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                                                    </svg>
                                                </button>
                                            </td>
                                            <tds></td>
                                        </tr>
                                        {% endfor %}     
                                        {% else %}
                                        <tr>
                                            <td colspan="8">Sin registros</td>
                                        </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
    
                            
                        </div>
                    </div>
    
                </div>
            </div>
        </div>
    </div>
    <!--  -->

    <!-- Tabla de pagos -->
    <div class="row d-flex justify-content-center">
        <div class="col-8">
            <div class="card rounded-4 mb-5">
                <div class="card-header">
                    <h3 class="card-title text-center">Información de pagos</h3>
                </div>
                <!--  -->
                <div class="card-body">

                    <div class="d-grid justify-content-center mb-3">
                        <a href="{{url_for('agregar_pago', id_alumno=alumno.id)}}" class="btn btn-success rounded-3 fw-semibold">Haz click aquí para validar un nuevo pago en el sistema</a>
                    </div>

                    <!-- Tabla -->
                    <div class="d-flex justify-content-center">
                        <table class="table table-bordered table-hover rounded-4 overflow-hidden text-center shadow">
                            <thead class="table-dark">
                                <tr>
                                    <th></th>
                                    <th scope="col">Item</th>
                                    <th scope="col">Fecha de pago</th>
                                    <th scope="col">Fecha de corte</th>
                                    <th scope="col">Monto</th>
                                    <th scope="col"></th>
                                    <th scope="col">Abono</th>
                                    <th scope="col"></th>
                                    <th scope="col">Adeudo</th>
                                    <th scope="col" class="px-0">Acciones</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if info_pagos != None %}
                                {% for registro in info_pagos %}
                                <tr style="cursor: pointer;">
                                    <td></td>
                                    <td> {{ loop.index }} </td>
                                    <td> {{ registro[4] }} </td>
                                    <td> {{ registro[5] }} </td>
                                    <td> ${{ registro.Monto_total }} </td>
                                    <td>=</td>
                                    <td> {{ '$'~registro[2] if registro[2] > 0 else '-' }} </td>
                                    <td>+</td>
                                    <td> {{ '$'~registro[3] if registro[3] > 0 else '-' }} </td>
                                    <td class="d-grid gap-0 d-table-cell p-0">
                                        <button type="button" class="btn btn-primary scale-anim fw-semibold button-detalle"
                                            data-bs-toggle="collapse" data-bs-target="#collapseDetalle-{{registro[0]}}"
                                            data-id-alumno-pago="{{ registro[0] }}"
                                            aria-expanded="false" aria-controls="collapseExample">
                                           Ver detalle                                        
                                        </button>

                                        <button type="button" class="btn btn-danger scale-anim fw-semibold"
                                            data-bs-toggle="modal"  data-bs-target="#modal-eliminar-pago"
                                            data-id-pago-alumno="{{ registro[0] }}" 
                                            data-id-alumno="{{ alumno.id }}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="20" fill="white" class="bi bi-trash-fill" viewBox="0 0 16 16">
                                                <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0" />
                                            </svg>
                                        </button>
                                    </td>
                                    <td></td>
                                </tr>
                                <!-- Subtabla de detalle del pago -->
                                <tr>
                                    {# Parte de la tabla que se colapsa para mostrar el detalle de pagos #}
                                    <td colspan="11" id="collapseDetalle-{{registro[0]}}" class="collapse">
                                        <div class="card m-2">
                                            
                                            <div class="container py-2 px-4">
                                                <div class="row d-flex justify-content-center mt-3">
                                                    <!--  -->
                                                    <div class="col-5 lh-1">
                                                        <p>Informacion del pago</p>
                                                        <table class="table table-bordered text-start table-striped-columns">
                                                            <thead class="table-active">
                                                                <tr>
                                                                    <th colspan="2" class="text-center"><small>Detalles</small></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    <td><small>Realizado por</small></td>
                                                                    <td><small> {{alumno.nombres}} {{alumno.apellido_paterno}} {{alumno.apellido_materno}} </small></td>
                                                                </tr>
                                                                <tr>
                                                                    <td><small>Fecha del pago</small></td>
                                                                    <td><small> {{ registro[4] }} </small></td>
                                                                </tr>
                                                                <tr>
                                                                    <td><small>Fecha límite de pago</small></td>
                                                                    <td><small> {{ registro[5] }} </small></td>
                                                                </tr>
                                                                <tr>
                                                                    <td><small>Monto total</small></td>
                                                                    <td><small>${{registro[6]}}</small></td>
                                                                </tr>
                                                                <tr>
                                                                    <td><small>Meses abonados</small></td>
                                                                    <td><small>{{registro[7]}}</small></td>
                                                                </tr>
                                                                <tr>
                                                                    <td><small>Abono</small></td>
                                                                    <td><small> {{ '$'~registro[2] if registro[2] > 0 else '-' }} </small></td>
                                                                </tr>
                                                                <tr>
                                                                    <td><small>Meses adeudados</small></td>
                                                                    <td><small>{{registro[8]}}</small></td>
                                                                </tr>
                                                                <tr>
                                                                    <td><small>Adeudo</small></td>
                                                                    <td><small> {{ '$'~registro[3] if registro[3] > 0 else '-' }} </small></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <!--  -->
                                                    <div class="col-4 lh-1">
                                                        <!--Tabla historial abonos-->
                                                        <p>Mes abonado</p>
                                                        <table class="table table-bordered">
                                                            <thead class="table-active">
                                                                <tr>
                                                                    <th class="text-center"><small>Mes</small></th>
                                                                    <th class="text-center"><small>Año</small></th>
                                                                    <th class="text-center"><small>Monto</small></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="tabla-abonos-body-{{registro[0]}}">
                                                            </tbody>
                                                        </table>
                                                        <hr>
                                                        <!--Tabla historial adeudos-->
                                                        <p>Mes adeudado</p>
                                                        <table class="table table-bordered">
                                                            <thead class="table-active">
                                                                <tr>
                                                                    <th class="text-center"><small>Mes</small></th>
                                                                    <th class="text-center"><small>Año</small></th>
                                                                    <th class="text-center"><small>Monto</small></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="tabla-adeudos-body-{{registro[0]}}">
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <!--  -->
                                                </div>
                                            </div>

                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="3">Sin registros</td>
                                </tr>
                                {% endif %}
                            </tbody>

                        </table>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!--  -->
</div>

{% else %}
<h1>No hay alumno</h1>
{% endif %}

<script src="{{ url_for('static', filename='js/agregarAlumno.js') }}" defer></script>
<script defer src="{{url_for('static', filename='js/validacion-clase.js')}}"></script>

<script>
$(()=>{
    const hidennThings = document.querySelectorAll('.hide-this');
    Array.from(hidennThings).forEach(hidden => {
        hidden.style.display = 'none';
    });

    $('#editar-cinta-modal').get(0).addEventListener('show.bs.modal', evt => {
        let button = evt.relatedTarget
        let id = $(button).data('id')
        let cinta = $(button).data('cinta')
        console.log(cinta)
        $('#cinta-alumno-id').attr('value', id).val(id)
        $('#cinta-nuevo-valor').attr('value', cinta).val(cinta)
    });

    $('#eliminar-asistencia-modal').on('show.bs.modal', evt => {
        let button = evt.relatedTarget
        let id_alumno = $(button).data('alumno-id')
        let fecha_eliminar = $(button).data('fecha')
        let dia_eliminar = $(button).data('dia-sem')
        let hora_eliminar = $(button).data('hora')
        $('#id_alumno_eliminar').attr('value', id_alumno).val(id_alumno)
        $('#fecha_eliminar').attr('value', fecha_eliminar).val(fecha_eliminar)
        console.log(fecha_eliminar)
        console.log(id_alumno)
        $('#dia_eliminar').attr('value', dia_eliminar).val(dia_eliminar)
        $('#hora_eliminar').attr('value', hora_eliminar).val(hora_eliminar)
    })

    $('#modal-eliminar-pago').on('show.bs.modal', evt => {
        let button = evt.relatedTarget
        let id_alumno = $(button).data('id-alumno')
        let id_pago_alumno = $(button).data('id-pago-alumno')
        $('#id_pago_alumno-pago').val(id_pago_alumno).attr('value', id_pago_alumno)
        console.log($('#id_pago_alumno-pago').val())
        $('#id_alumno-pago').val(id_alumno).attr('value', id_alumno)
    })

    botones = document.querySelectorAll('.button-detalle')
    Array.from(botones).forEach(btn => {

        btn.addEventListener('click', evt => {
            id = $(btn).data('id-alumno-pago')
            requestAdeudos(id)
            requestAbonos(id)
        })
    })

    function onBotonDetalle(evt) {
        id = $(evt.target).data('id-alumno-pago')
            requestAdeudos(id)
            requestAbonos(id)
    }


    function requestAdeudos(id) {
        const route = `/api/historial/adeudos/${id}`
        $.ajax({
            url: route,
            dataType: 'json',
            async: false,
            success: function(result) {
                console.log(`Ajax: ${typeof(result)}`)
                console.log(result.length)
                if (result.length == 0) {
                    const template = `
                    <tr>
                        <td colspan="3">Sin adeudos</td>
                    </tr>`     
                    $(`#tabla-adeudos-body-${id}`).children().remove()  
                    $(`#tabla-adeudos-body-${id}`).append(template)    
                    return
                }

                $(`#tabla-adeudos-body-${id}`).children().remove()
                for (let index = 0; index < result.length; index++) {
                    const registro = result[index];
                    var campos = Object.keys(registro);
                    var datos = Object.values(registro);
                    console.log(campos)
                    console.log(datos)
                    
                    var nombre_mes = 0
                    if (registro.Nombre_mes == 1)
                        nombre_mes = 'enero'
                    else if (registro.Nombre_mes == 2)
                        nombre_mes = 'febrero'
                    else if (registro.Nombre_mes == 3)
                        nombre_mes = 'marzo'
                    else if (registro.Nombre_mes == 4)
                        nombre_mes = 'abril'
                    else if (registro.Nombre_mes == 5)
                        nombre_mes = 'mayo'
                    else if (registro.Nombre_mes == 6)
                        nombre_mes = 'junio'
                    else if (registro.Nombre_mes == 7)
                        nombre_mes = 'julio'
                    else if (registro.Nombre_mes == 8)
                        nombre_mes = 'agosto'
                    else if (registro.Nombre_mes == 9)
                        nombre_mes = 'septiembre'
                    else if (registro.Nombre_mes == 10)
                        nombre_mes = 'octubre'
                    else if (registro.Nombre_mes == 11)
                        nombre_mes = 'noviembre'
                    else if (registro.Nombre_mes == 12)
                        nombre_mes = 'diciembre'
    
                    const template = `
                    <tr>
                        <td><small>${nombre_mes}</<small></td>
                        <td><small>${registro.Anio}</<small></td>
                        <td>$600</td>
                    </tr>`
                    $(`#tabla-adeudos-body-${id}`).append(template)      
                }
                const footer = `
                    <tr>
                        <td colspan="2" class="table-active text-end"><small>Total adeudo</small></td>
                        <td><small>$${result.length * 600.0}</<small></td>
                    </tr>` 
                $(`#tabla-adeudos-body-${id}`).append(footer)
            },
            error: function(jqXHR, exception) {
                if (jqXHR.status === 0) {
                    alert('Not connect.\n Verify Network.');
                } else if (jqXHR.status == 404) {
                    alert('Requested page not found. [404]');
                } else if (jqXHR.status == 500) {
                    alert('Internal Server Error [500].');
                } else if (exception === 'parsererror') {
                    alert('Requested JSON parse failed.');
                } else if (exception === 'timeout') {
                    alert('Time out error.');
                } else if (exception === 'abort') {
                    alert('Ajax request aborted.');
                } else {
                    alert('Uncaught Error.\n' + jqXHR.responseText);
                }
            }
        })
    }

    function requestAbonos(id) {
        const route = `/api/historial/abonos/${id}`
        $.ajax({
            url: route,
            dataType: 'json',
            async: true,
            success: function(result) {
                console.log(`Ajax: ${typeof(result)}`)
                if (result.length == 0) {
                    const template = `
                    <tr>
                        <td colspan="3">Sin abonos</td>
                    </tr>`     
                    $(`#tabla-abonos-body-${id}`).children().remove()  
                    $(`#tabla-abonos-body-${id}`).append(template)
                    return
                }

                $(`#tabla-abonos-body-${id}`).children().remove()
                for (let index = 0; index < result.length; index++) {
                    const registro = result[index];
                    var campos = Object.keys(registro);
                    var datos = Object.values(registro);
                    console.log(campos)
                    console.log(datos)
                    console.log(registro.Nombre_mes)
                    
                    var nombre_mes = 0
                    if (registro.Nombre_mes == 1)
                        nombre_mes = 'enero'
                    else if (registro.Nombre_mes == 2)
                        nombre_mes = 'febrero'
                    else if (registro.Nombre_mes == 3)
                        nombre_mes = 'marzo'
                    else if (registro.Nombre_mes == 4)
                        nombre_mes = 'abril'
                    else if (registro.Nombre_mes == 5)
                        nombre_mes = 'mayo'
                    else if (registro.Nombre_mes == 6)
                        nombre_mes = 'junio'
                    else if (registro.Nombre_mes == 7)
                        nombre_mes = 'julio'
                    else if (registro.Nombre_mes == 8)
                        nombre_mes = 'agosto'
                    else if (registro.Nombre_mes == 9)
                        nombre_mes = 'septiembre'
                    else if (registro.Nombre_mes == 10)
                        nombre_mes = 'octubre'
                    else if (registro.Nombre_mes == 11)
                        nombre_mes = 'noviembre'
                    else if (registro.Nombre_mes == 12)
                        nombre_mes = 'diciembre'
    

                    const template = `
                    <tr>
                        <td><small>${nombre_mes}</<small></td>
                        <td><small>${registro.Anio}</<small></td>
                        <td>$600</td>
                    </tr>`     
                    
                    $(`#tabla-abonos-body-${id}`).append(template)      
                }
                const footer = `
                    <tr>
                        <td colspan="2" class="table-active text-end"><small>Total abono</small></td>
                        <td><small>$${result.length * 600.0}</<small></td>
                    </tr>` 
                $(`#tabla-abonos-body-${id}`).append(footer)
            },
            error: function(jqXHR, exception) {
                if (jqXHR.status === 0) {
                    alert('Not connect.\n Verify Network.');
                } else if (jqXHR.status == 404) {
                    alert('Requested page not found. [404]');
                } else if (jqXHR.status == 500) {
                    alert('Internal Server Error [500].');
                } else if (exception === 'parsererror') {
                    alert('Requested JSON parse failed.');
                } else if (exception === 'timeout') {
                    alert('Time out error.');
                } else if (exception === 'abort') {
                    alert('Ajax request aborted.');
                } else {
                    alert('Uncaught Error.\n' + jqXHR.responseText);
                }
            }
        })
    }

})
</script>
{% endblock %}